# 发布应用

Z-Blog 官方搭建的[`Z-Blog 应用中心`](https://app.zblogcn.com/) 是广大 Z-Blog 使用者和开发者提供了主题和插件大本营，提供免费与收费的 Z-Blog & Z-BlogPHP 主题、模板和插件的下载。

任何希望为 Z-Blog 做贡献的开发者都可以免费加入到应用中心并发布自己的因为给所有用户使用。为了保持应用中心应用质量，我们制定了一些应用上架的基本要求，在您的应用符合相应标准后即可发布到应用中心，

## 申请流程图

![alt 开发者申请流程图](https://bbs.zblogcn.com/upload/attach/202201/982_29RG725PNFXGCTR.png)

## 成为开发者

当您想首次发布您的应用时，请提供您开发的应用，并参照如下网址内容发贴或联系我们：

> 欢迎加入 Z-Blog 应用开发者中心-网站事务-Z-Blogger 技术交流中心：
>
> [https://bbs.zblogcn.com/thread-77001.html](https://bbs.zblogcn.com/thread-77001.html "欢迎加入Z-Blog应用开发者中心-网站事务-Z-Blogger 技术交流中心")
>
> \-----
>
> Z-Blog 应用审议群：836912740 「[加群链接](https://jq.qq.com/?_wv=1027&k=qmkm7HSQ "Z-Blog 应用审核群")」

审核通过后给予开发者权限，之后可上传应用到「应用中心（`https://app.zblogcn.com/`）」。

**注：后续应用实行上传后审核发布。**

<details>
<summary>开发者申请流程（点击展开）</summary>

> **Z-Blog 全新的应用中心，为众多开发者提供一个展示自己作品的平台。**

**注：此贴文本复制于「[成为开发者 - 发布应用 - Z-BlogPHP 文档](https://docs.zblogcn.com/php/#/books/dev-45-publish?id=%e6%88%90%e4%b8%ba%e5%bc%80%e5%8f%91%e8%80%85 "成为开发者 - 发布应用 - Z-BlogPHP 文档")」，不要直接编辑；**

### 前置要求

依据《中华人民共和国网络安全法》的要求，及为尽快通知到您，您必须：

1. 绑定手机号，以完成实名认证要求：https://uc.zblogcn.com/user/security/phone
2. 绑定微信号，以及时获取审核消息：https://uc.zblogcn.com/user/open/wechat_mp
3. 提交您的身份证号，完成实名认证：https://uc.zblogcn.com/user/identity
4. 「可选」开启“两步验证”，https://uc.zblogcn.com/user/security/tfa/google

如果您需要销售收费应用，您必须向我们提供：

1. 绑定您的支付宝，以获取收款：https://uc.zblogcn.com/user/open/alipay

### 申请流程

请在【[开发者中心-ZBlogger 技术交流中心](https://bbs.zblogcn.com/forum-125.html "开发者中心-ZBlogger 技术交流中心")】版块按以下要求发贴申请：

1. 为节省时间，请先参照「[注意事项速查表](books/dev-50-faq?id=注意事项速查表 "注意事项速查表")」进行自查；
2. 在「**你自己的网站**」内发布主题或插件，附截图、功能介绍等；
3. 「**在你的发布页面内**」以附件或网盘或「**Git 地址**」形式提供下载；「**不在要论坛发附件！！！**」
4. 网站本身如为 Z-Blog，须保留带链接的 Powerd By 声明；其他程序须在首页添加指向`www.zblogcn.com`的友情链接；
5. 网站自身定位或其他原因不适合发布应用的，直接用「Z-Blog + 二级域名」现搭一个也很合理吧；
6. 如果发布的应用为主题，则主题内也应正确标识 Z-Blog 版权；「`Powered By {$zblogphphtml}`」
7. 在论坛发申请贴，贴子内附上发布页的链接；「**不在要论坛发附件！！！**」
8. 不得重复发申请贴，不得擅自更换待审应用；
9. 按审核意见修改更新后应于原帖内回复当次更新的 Changelog；「**会写更新记录很重要**」
10. 如果你没看过「[站内发文规范（申请开发者也先看这里）-网站事务-ZBlogger 技术交流中心](https://bbs.zblogcn.com/thread-102989.html "站内发文规范（申请开发者也先看这里）-网站事务-ZBlogger 技术交流中心")」也请先看一遍；
11. 加 QQ 群，积极询问进度；**「群号： 836912740 」**
12. 准开发者需要有很多的耐心(不停的修改)，可能还需要较强的心理素质(否则有可能会被喷走)；

注：「应用发布」版块是独立于开发者申请的，可以发，也可以传附件，但是不能用于申请开发者；

### 发贴格式示意

标题格式：

> `申请开发者「appID」「plugin | theme」`

↑ 方引号比较好看，当然`[]`或`【】`也可以；

正文示例：

> 应用名称：XXXX
>
> 发布地址：https://blog.zblogcn.com/?id=1022
>
> 应用简介：功能描述什么的，尽量简短，更详细的放在你的发布页内；
>
> \<!-- 不需要配图，不然回贴给意见会很麻烦 --\>

### 审议 QQ 群

群号：836912740

### 其他
Z-BlogPHP 官方文档：https://docs.zblogcn.com/php/#/

注意事项速查表：https://docs.zblogcn.com/php/#/books/dev-50-faq  ←← 高优先级

[开发者准入规范讨论贴-网站事务-ZBlogger 技术交流中心](https://bbs.zblogcn.com/thread-103787.html "开发者准入规范讨论贴-网站事务-ZBlogger 技术交流中心")  ←← 优先级较低

</details>

## 发布标准

> **推荐阅读：[注意事项速查表](books/dev-50-faq?id=%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9%e9%80%9f%e6%9f%a5%e8%a1%a8 "常见问题")**

<details>
<summary>此节内容需重新组织（点击展开）</summary>

### A.通用
1. 开启 debug 模式后不得报错
2. 不得含有木马等有害代码
3. 不得含有任何被加密的 PHP(含 Z5 加密），只能由应用中心服务器端加密
4. PHP 文件应保存为 UTF-8 no BOM 编码；
5. 不得有安全漏洞（包括 SQL 注入、跨站脚本攻击、跨站请求伪造等）
6. 不得引用外站资源（尤其是小站资源）
7. 自动审核内容里不得有黄色提示（使用较老旧版本的 js 等）
8. 不得以免费为饵跳过“应用中心支付系统”搞“内置收费”（微博、微信、支付宝等支付社交系统或其它功能 API 必须要收费除外）
9. 不得有免费或低价诱导后续高消费或是明显高于市场定价等不良意图或是违反公序良俗
10. 不得修改保存系统源码或是系统默认语言包

### B.主题
1. 主题里没有 zblog 版权
2. 自动审核后的截图，出现错位等不正常的
3. 标题等长度过长不会导致变形
4. 摘要的空格被移除的
5. ul,ol,li,blockquote 等 Html 元素样式错误的
6. 需要提供配置的地方没的可配置的页面
7. 评论层级不对

### C.插件
1. 数据库表和 Class 没有使用 zbp 的标准数据库创建操作规范的
2. 数据库操作没有使用链式对象等系统自带操作而使用自行拼接 sql 代码的
3. 在应该用$zbp→CheckRights 判断权限的地方用最简单的 $zbp→User→Level 去判断的

### D.上传后的应用发布内容
1. 缺少前台展示截图（如有前台展示的话）
2. 缺少后台截图（如有后台配置的话）
3. 缺少基本的（或详细）使用说明和功能介绍

### E.禁止条款
1. 禁止抄袭复制有版权保护的主题模板
2. 禁止多次提交无意义的应用去刷新排行

</details>

## 完善简介

## 提交发布

## 应用审核

## 应用加密说明
[`Z5加密`](https://z5encrypt.com/) 是由 Z-Blog 应用中心推出的 PHP 加密方案，也是 「Z-Blog 应用中心」 唯一支持的加密方案。为确保用户权益，只有 Z5 加密后的加密文件被允许上架到应用中心，非使用 Z5 加密的应用代码必须以明文形式提交到应用中心上架。

`Z5加密` 相关介绍内容详见：https://z5encrypt.com/docs/

使用说明见：https://z5encrypt.com/docs/usage/

## 应用验证
为保证开发者利益，应用中心提供应用购买验证系统用于验证用户使用应用的合法性。应用验证系统与应用中心独立，即使应用中心网站无法访问，也不影响应用验证系统的正常运行。

**开发者应用验证调用**

应用验证系统与应用中心独立，即使应用中心网站无法访问，也不影响应用验证系统的正常运行。

**新版本 V2 验证**

仅提供 PHP 版本代码，请在应用中心网站后台 → 开发者工具 → 验证代码处获得。

**添加指南**
1. 添加在 `InstallPlugin` 函数中，实现启用插件时自动验证。
2. 需要运行某些速度慢的功能时，如批量发邮件等，可在这之前进行验证。

建议配合 Z5 加密使用。

**不正确行为**
1. 验证因需要连接服务器，会严重影响页面访问速度。因此，不允许在模板的浏览页等地方插入这部分代码。
2. 即使验证不通过，也不允许对用户的数据进行任何意义上的破坏。

## 应用验证回调

### 验证服务端
验证系统会对验证结果加密后，通知到开发者设置的回调地址。HTTP 方法为 `POST`，`Content-Type` 为 `application/zblogverify`。

Body 的加密方式为：**RSA(base64(AES_KEY) + '.' + base64(AES_IV) + '.' + HS256(realData) + '.' + timestamp) + '.' + AES(realData)**

RSA 公钥和 HMAC-SHA256 密钥见示例代码。

### 明文数据格式
```json
{
	"id": "65fbe736-aa01-4d60-946a-64da5e1bccd7", /* 本次校验的唯一ID，每一次校验返回值都不同 */
	"from": "initiative", /* 校验来源 */
	"error": {
		"number": 0, /* 错误编号 */
		"message": "OK", /* 错误信息 */
		"verified": true, /* 是否验证成功 */
		"cracking": false, /* 疑似破解 */
		"user": {
			"message": "面向用户的错误信息"
		}
	},
	"appId": "应用ID",
	"host": "网站",
	"user": {
		"id": "应用中心ID",
		"username": "用户账号"
	},
  "modified": "应用最后修改日期（时间戳）",
	"license": {
		"appId": "授权文件保存的应用ID",
		"userId": "授权文件保存的用户ID",
		"timestamp": "授权文件生成时间戳"
	}
}
```

### 示例代码(PHP)
以下代码仅能运行于 PHP 5.3+。请注意，以下代码不对重放攻击做出保证，在入库前请先确认 ID 是否唯一。
```php
<?php
function getVerifyData($data) {
	$publicKey = openssl_pkey_get_public('-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoH4uiMZYWy1sOXuq4YAA
MtyrAtUcWHOXalSAmtDs1FA2H8fTBbEF+gnvg83Byp/mIvHMIaXc7RPIniwoMgDo
Xo3H0GquBEOH4YoufIqfRFGFwnBw7V1KNv9Iw4XpmBYEboD5HT4PLuoUvSP78iWK
7kMMsYsYOVi7EPn8DbPZbvxnrDXkJmkj3l8YhGWtAjbFU7XgyEKEKBTes9fcxWSW
GCdd1jV9oXcV9EQRkRr50wMvydgIWAAWvcVZ5zzK4sZelZDaGz7yEXG/Q1F1Xp3e
GcC057CQoaEzuTQILUCypiNeQpKdzGXxwyp+Q6DAYITjyFBjQ5WbQiSaZtCPV5D9
lwIDAQAB
-----END PUBLIC KEY-----');
	$rsaDecrypted = '';
	$explodeData = explode('.', $data);
	$rsaEncrypted = $explodeData[0];
	$aesEncrypted = $explodeData[1];
	openssl_public_decrypt(base64_decode($rsaEncrypted), $rsaDecrypted, $publicKey);
	$aesInfo = explode('.', $rsaDecrypted);
	$aesKey = base64_decode($aesInfo[0]);
	$aesIv = base64_decode($aesInfo[1]);
	$hash = $aesInfo[2];
	$data = openssl_decrypt(
    base64_decode($aesEncrypted),
    'aes-256-cbc',
    $aesKey,
    OPENSSL_RAW_DATA,
    $aesIv
  );
	if (hash_hmac('sha256', $data, 'zblogverification') === $hash) {
		return json_decode($data, false);
	} else {
		throw new Exception('Hash error!');
	}
}

$object = getVerifyData(file_get_contents('php://input'));

if ($object->error->verified) {
	echo '验证通过';
}

var_dump($object);
```

### 测试数据

```bash
PpBHLt70jUUpA1TdP38tm68bVWxRKDA69GqR04PA6on3lcGAwz2s8Dj4qMvCuMosI6
7b1JNFVELfMmxt1RfKQsSS2vLtIVdblDbmZCBptNd5IYNx2qFZFQQ5Hju3bhwR9VDW
8fcy63bEOpWVYxAEhQXT3ztaLZn63gJhpDemA06Emxv6VJgxfe9uLTX31FCDfg6yd
```

### 服务端插件
你可以直接使用如上代码自行搭建服务端系统，也可以直接使用插件，并在应用中心后台填写回调地址即可:https://bbs.zblogcn.com/thread-94905-1-1.html
